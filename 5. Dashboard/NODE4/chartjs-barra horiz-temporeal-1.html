<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Gráfico Guage com Chart.js</title>
    <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        .gradiente {
            background: rgb(255,0,0);
            background: linear-gradient(90deg, rgba(255,0,0,1) 0%, rgba(245,255,0,1) 25%, rgba(0,255,29,1) 50%, rgba(245,255,0,1) 75%, rgba(255,0,0,1) 100%);
        }
    </style>
</head>

<body>
    
    Última leitura: <br>
    <div style="width: 60%;" class="gradiente">
        <div id="div_posicao" style="margin-left:0%; font-size: 20pt;">
            <b id="b_leitura">0</b> lumens
        </div>
    </div>

    <br>
    Mínimo: <b id="b_min"></b> <br>
    Máximo: <b id="b_max"></b> <br>

</body>

</html>

<script>

    // essas 2 funções irão recuperar seus valores do backend futuramente
    function maximo() {
        return 600;
    }

    function minimo() {
        return 300;
    }

	// esse "sortearTemperatura()" será desnecessário quando usarmos o backend futuramente
	function sortearTemperatura() {
        var minimoAbsoluto = Math.abs(minimo());
		return ((Math.random() * 300) + 300).toFixed(1);
	}

    function receberNovasLeituras() {
		setTimeout(() => {

            b_max.innerHTML = maximo();
            b_min.innerHTML = minimo();

            var ajusteLimiteMin = Math.abs(minimo());

			// esse "novoRegistro" será recuperado do backend futuramente
			var novoRegistro = {
				momento: '00:00:00', // tanto faz
				leitura: Number(sortearTemperatura())
			};

            var posicao = (novoRegistro.leitura + ajusteLimiteMin) / (maximo()) *100;
			
            div_posicao.style.marginLeft = `${posicao}%`;
            b_leitura.innerHTML = novoRegistro.leitura;

			receberNovasLeituras();	

		}, 1000); // 1000 ms -> 1 segundo
	}


    window.onload = receberNovasLeituras;
</script>